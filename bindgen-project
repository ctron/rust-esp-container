#!/usr/bin/env bash

set -ex

FLAGS=""
FLAGS+=" --sysroot=/esp/xtensa-esp32-elf/xtensa-esp32-elf/sysroot"
FLAGS+=" -I/build/build/include"
FLAGS+=" -D__bindgen"
FLAGS+=" -target xtensa"
FLAGS+=" -x c"

for i in $(find "$IDF_PATH/components" -maxdepth 3 -name include); do
	FLAGS+=" -I$i"
done

: ${BINDGEN_FLAGS:="--use-core --no-layout-tests --ctypes-prefix=libc"}

bindgen $BINDGEN_FLAGS --output esp32-sys/src/bindings.rs esp32-sys/src/bindings.h -- $FLAGS

